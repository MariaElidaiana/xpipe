

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Python wrapper for xshear &mdash; proclens 0.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="proclens 0.1 documentation" href="index.html"/>
        <link rel="prev" title="Frequently Asked Questions" href="faq.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> proclens
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">User Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">F.A.Q</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Python wrapper for xshear</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#create-xhsear-style-lens-catalog">Create xhsear-style lens catalog</a></li>
<li class="toctree-l2"><a class="reference internal" href="#read-ra-dec-positions-for-lenses">Read (RA, DEC) positions for lenses</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#processing-results-from-xshear">Processing results from xshear</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#read-xshear-output-from-single-file">Read xshear output from single file</a></li>
<li class="toctree-l2"><a class="reference internal" href="#read-xshear-output-from-multiple-files">Read xshear output from multiple files</a></li>
<li class="toctree-l2"><a class="reference internal" href="#base-xshear-readers">Base xshear readers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#logarithmic-bin-properties">Logarithmic bin properties</a></li>
<li class="toctree-l2"><a class="reference internal" href="#jackknife-label-assignment">Jackknife label assignment</a></li>
<li class="toctree-l2"><a class="reference internal" href="#stacked-profile-container">Stacked Profile Container</a></li>
<li class="toctree-l2"><a class="reference internal" href="#jackknife-covariance-estimate-from-multiple-lensing-profiles">Jackknife Covariance estimate from multiple lensing profiles</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#ancillary-utilities">Ancillary utilities</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#observed-to-absolute-magnitude-conversion">Observed to absolute magnitude conversion</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fits-to-pandas-conversion">FITS to pandas conversion</a></li>
<li class="toctree-l2"><a class="reference internal" href="#parameter-selection">parameter selection</a></li>
<li class="toctree-l2"><a class="reference internal" href="#list-partitioning">list partitioning</a></li>
<li class="toctree-l2"><a class="reference internal" href="#safe-divide">safe divide</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#visualization">Visualization</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#corner-plot">corner plot</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">proclens</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Python wrapper for xshear</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/api.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="toctree-wrapper compound">
</div>
<div class="section" id="python-wrapper-for-xshear">
<h1>Python wrapper for xshear<a class="headerlink" href="#python-wrapper-for-xshear" title="Permalink to this headline">¶</a></h1>
<div class="section" id="create-xhsear-style-lens-catalog">
<h2>Create xhsear-style lens catalog<a class="headerlink" href="#create-xhsear-style-lens-catalog" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="proclens.xhandle.ioshear.makecat">
<code class="descclassname">proclens.xhandle.ioshear.</code><code class="descname">makecat</code><span class="sig-paren">(</span><em>fname</em>, <em>mid</em>, <em>ra</em>, <em>dec</em>, <em>z</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/proclens/xhandle/ioshear.html#makecat"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#proclens.xhandle.ioshear.makecat" title="Permalink to this definition">¶</a></dt>
<dd><p>Write an xshear style lens catalog to file</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>fname</strong> (<em>str</em>) – full path to file</li>
<li><strong>mid</strong> (<em>np.array – int</em>) – ID of object</li>
<li><strong>ra</strong> (<em>np.array</em>) – RA</li>
<li><strong>dec</strong> (<em>np.array</em>) – DEC</li>
<li><strong>z</strong> (<em>np.array</em>) – redshift</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="read-ra-dec-positions-for-lenses">
<h2>Read (RA, DEC) positions for lenses<a class="headerlink" href="#read-ra-dec-positions-for-lenses" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="proclens.xhandle.ioshear.read_lens_pos">
<code class="descclassname">proclens.xhandle.ioshear.</code><code class="descname">read_lens_pos</code><span class="sig-paren">(</span><em>fnames</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/proclens/xhandle/ioshear.html#read_lens_pos"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#proclens.xhandle.ioshear.read_lens_pos" title="Permalink to this definition">¶</a></dt>
<dd><p>Reads postions based on the list of filenames passed</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>fname</strong> (<em>str</em>) – full paths to output files</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">ra, dec of lenses</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">np.array</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
</div>
<div class="section" id="processing-results-from-xshear">
<h1>Processing results from xshear<a class="headerlink" href="#processing-results-from-xshear" title="Permalink to this headline">¶</a></h1>
<div class="section" id="read-xshear-output-from-single-file">
<h2>Read xshear output from single file<a class="headerlink" href="#read-xshear-output-from-single-file" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="proclens.xhandle.ioshear.read_single_bin">
<code class="descclassname">proclens.xhandle.ioshear.</code><code class="descname">read_single_bin</code><span class="sig-paren">(</span><em>fname</em>, <em>metaname=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/proclens/xhandle/ioshear.html#read_single_bin"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#proclens.xhandle.ioshear.read_single_bin" title="Permalink to this definition">¶</a></dt>
<dd><p>Reads and interprets xshear output from a single file</p>
<p><code class="code docutils literal"><span class="pre">info</span></code> and <code class="code docutils literal"><span class="pre">data</span></code> are passed on from <strong>xread</strong>,
while <code class="code docutils literal"><span class="pre">sheared_data</span></code> is just a list of <code class="code docutils literal"><span class="pre">data</span></code> tables corresponding to
metacalibration sheared results.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>fname</strong> (<em>str</em>) – full path to output file</li>
<li><strong>metaname</strong> (<em>str</em>) – full base path to sheared output file</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><code class="code docutils literal"><span class="pre">info</span></code>, <code class="code docutils literal"><span class="pre">data</span></code>, <code class="code docutils literal"><span class="pre">sheared_data</span></code></p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">np.ndarray, np.ndarray, list of np.ndarray</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="read-xshear-output-from-multiple-files">
<h2>Read xshear output from multiple files<a class="headerlink" href="#read-xshear-output-from-multiple-files" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="proclens.xhandle.ioshear.read_multiple_bin">
<code class="descclassname">proclens.xhandle.ioshear.</code><code class="descname">read_multiple_bin</code><span class="sig-paren">(</span><em>fnames</em>, <em>metanames=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/proclens/xhandle/ioshear.html#read_multiple_bin"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#proclens.xhandle.ioshear.read_multiple_bin" title="Permalink to this definition">¶</a></dt>
<dd><p>Reads and interprets xshear output from many smaller files</p>
<p><code class="code docutils literal"><span class="pre">info</span></code> and <code class="code docutils literal"><span class="pre">data</span></code> are passed on from <strong>xread</strong>,
while <code class="code docutils literal"><span class="pre">sheared_data</span></code> is just a list of <code class="code docutils literal"><span class="pre">data</span></code> tables corresponding to
metacalibration sheared results.</p>
<p><code class="code docutils literal"><span class="pre">chunk_ids</span></code> assigned to each row to indicate which chunk it originally came from</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>fname</strong> (<em>str</em>) – full path to output file</li>
<li><strong>metaname</strong> (<em>str</em>) – full base path to sheared output file</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><code class="code docutils literal"><span class="pre">info</span></code>, <code class="code docutils literal"><span class="pre">data</span></code>, <code class="code docutils literal"><span class="pre">sheared_data</span></code>, <code class="code docutils literal"><span class="pre">chunk_ids</span></code></p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">np.ndarray, np.ndarray, list of np.ndarray, np.array</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="base-xshear-readers">
<h2>Base xshear readers<a class="headerlink" href="#base-xshear-readers" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="proclens.xhandle.ioshear.xread">
<code class="descclassname">proclens.xhandle.ioshear.</code><code class="descname">xread</code><span class="sig-paren">(</span><em>xdata</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/proclens/xhandle/ioshear.html#xread"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#proclens.xhandle.ioshear.xread" title="Permalink to this definition">¶</a></dt>
<dd><p>Reader for xshear output if style is set as <cite>both</cite></p>
<p>Each row corresponds to the lensing profile of a single lens, average profiles require additional stacking</p>
<p>The output data is divided into two tables:</p>
<blockquote>
<div><p><code class="code docutils literal"><span class="pre">info</span></code> contains values relevant for the lens in general. It has a shape <code class="code docutils literal"><span class="pre">(N_lens,</span> <span class="pre">3)</span></code>.
the columns are:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">index</span><span class="p">:</span>      <span class="n">index</span> <span class="kn">from</span> <span class="nn">lens</span> <span class="n">catalog</span>
<span class="n">weight_tot</span><span class="p">:</span> <span class="nb">sum</span> <span class="n">of</span> <span class="nb">all</span> <span class="n">weights</span> <span class="k">for</span> <span class="nb">all</span> <span class="n">source</span> <span class="n">pairs</span> <span class="ow">in</span> <span class="nb">all</span> <span class="n">radial</span> <span class="n">bins</span>
<span class="n">totpairs</span><span class="p">:</span>   <span class="n">total</span> <span class="n">pairs</span> <span class="n">used</span>
</pre></div>
</div>
<p><code class="code docutils literal"><span class="pre">data</span></code> contains values for individual radial bins. It has a shape <code class="code docutils literal"><span class="pre">(12,</span> <span class="pre">N_lens,</span> <span class="pre">N_rbin)</span></code>,
the columns are:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">npair_i</span><span class="p">:</span>        <span class="n">number</span> <span class="n">of</span> <span class="n">pairs</span> <span class="ow">in</span> <span class="n">radial</span> <span class="nb">bin</span> <span class="n">i</span>
<span class="n">rsum_i</span><span class="p">:</span>         <span class="nb">sum</span> <span class="n">of</span> <span class="n">weights</span> <span class="o">*</span> <span class="n">sigma_crit_inv</span> <span class="o">*</span> <span class="n">r</span>
<span class="n">wsum_i</span><span class="p">:</span>         <span class="nb">sum</span> <span class="n">of</span> <span class="n">weights</span> <span class="o">*</span> <span class="n">sigma_crit_inv</span>
<span class="n">ssum_i</span><span class="p">:</span>         <span class="nb">sum</span> <span class="n">of</span> <span class="n">weights</span>
<span class="n">dsum_i</span><span class="p">:</span>         <span class="nb">sum</span> <span class="n">of</span> <span class="n">weights</span> <span class="o">*</span> <span class="n">g_t</span>
<span class="n">osum_i</span><span class="p">:</span>         <span class="nb">sum</span> <span class="n">of</span> <span class="n">weights</span> <span class="o">*</span> <span class="n">g_x</span>
<span class="n">dsensum_w_i</span><span class="p">:</span>    <span class="nb">sum</span> <span class="n">of</span> <span class="n">weights</span> <span class="o">*</span> <span class="n">sigma_crit_inv</span> <span class="o">*</span> <span class="n">gsens_t</span>
<span class="n">osensum_w_i</span><span class="p">:</span>    <span class="nb">sum</span> <span class="n">of</span> <span class="n">weights</span> <span class="o">*</span> <span class="n">sigma_crit_inv</span> <span class="o">*</span> <span class="n">gsens_x</span>
<span class="n">dsensum_s_i</span><span class="p">:</span>    <span class="nb">sum</span> <span class="n">of</span> <span class="n">weights</span> <span class="o">*</span> <span class="n">gsens_t</span>
<span class="n">osensum_s_i</span><span class="p">:</span>    <span class="nb">sum</span> <span class="n">of</span> <span class="n">weights</span> <span class="o">*</span> <span class="n">gsens_x</span>
<span class="n">mean_e1</span><span class="p">:</span>        <span class="nb">sum</span> <span class="n">of</span> <span class="n">weights</span> <span class="o">*</span> <span class="n">g_1</span>
<span class="n">mean_e2</span><span class="p">:</span>        <span class="nb">sum</span> <span class="n">of</span> <span class="n">weights</span> <span class="o">*</span> <span class="n">g_2</span>
</pre></div>
</div>
<p>In each case, _i means radial bin i</p>
</div></blockquote>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>xdata</strong> (<em>np.array</em>) – raw xshear output loaded to np array</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><code class="code docutils literal"><span class="pre">info</span></code>, <code class="code docutils literal"><span class="pre">data</span></code>, column description dictionary</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">np.ndarray, np.ndarray, <a class="reference external" href="https://docs.python.org/2/library/stdtypes.html#dict" title="(in Python v2.7)">dict</a></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="proclens.xhandle.ioshear.xpatches">
<code class="descclassname">proclens.xhandle.ioshear.</code><code class="descname">xpatches</code><span class="sig-paren">(</span><em>raw_chunks</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/proclens/xhandle/ioshear.html#xpatches"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#proclens.xhandle.ioshear.xpatches" title="Permalink to this definition">¶</a></dt>
<dd><p>Processes many smaller xshear output files via <strong>xread</strong></p>
<p>Outputs a concatenated array of the many smaller files, along with a
<code class="code docutils literal"><span class="pre">chunk_ids</span></code> assigned to each row to indicate which chunk it originally came from</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>raw_chunks</strong> (<em>list</em>) – list of raw xshear outputs loaded to np array</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><code class="code docutils literal"><span class="pre">info</span></code>, <code class="code docutils literal"><span class="pre">data</span></code>, <code class="code docutils literal"><span class="pre">chunk_ids</span></code></td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">np.ndarray, np.ndarray, np.array</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="logarithmic-bin-properties">
<h2>Logarithmic bin properties<a class="headerlink" href="#logarithmic-bin-properties" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="proclens.xhandle.shearops.redges">
<code class="descclassname">proclens.xhandle.shearops.</code><code class="descname">redges</code><span class="sig-paren">(</span><em>rmin</em>, <em>rmax</em>, <em>nbin</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/proclens/xhandle/shearops.html#redges"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#proclens.xhandle.shearops.redges" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates nominal edges and centers for logarithmic radial bins(base10 logarithm)</p>
<p>Edges and areas are exact, “center” values are estimated as CIRCUMFERENCE weighted
mean radius</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>rmin</strong> (<em>float</em>) – inner edge</li>
<li><strong>rmax</strong> (<em>float</em>) – outer edge</li>
<li><strong>nbin</strong> (<em>int</em>) – number of bins</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">centers, edges, areas</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">np.array, np.array, np.array</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="jackknife-label-assignment">
<h2>Jackknife label assignment<a class="headerlink" href="#jackknife-label-assignment" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="proclens.xhandle.shearops.assign_jk_labels">
<code class="descclassname">proclens.xhandle.shearops.</code><code class="descname">assign_jk_labels</code><span class="sig-paren">(</span><em>pos</em>, <em>centers</em>, <em>verbose=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/proclens/xhandle/shearops.html#assign_jk_labels"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#proclens.xhandle.shearops.assign_jk_labels" title="Permalink to this definition">¶</a></dt>
<dd><p>Assigns JackKnife labels to 2D points on the sky via spherical k-means</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>pos</strong> (<em>np.ndarray</em>) – positions of points in (RA, DEC)</li>
<li><strong>centers</strong> (<em>int or np.ndarray</em>) – Number of JK centers to use, or the (RA, DEC) coordinates of the centers</li>
<li><strong>verbose</strong> (<em>bool</em>) – verbose flag to pass to <strong>kmeans_radec</strong></li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">JK-labels, JK-centers</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">np.array, np.ndarray</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="stacked-profile-container">
<h2>Stacked Profile Container<a class="headerlink" href="#stacked-profile-container" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="proclens.xhandle.shearops.StackedProfileContainer">
<em class="property">class </em><code class="descclassname">proclens.xhandle.shearops.</code><code class="descname">StackedProfileContainer</code><span class="sig-paren">(</span><em>info</em>, <em>data</em>, <em>labels</em>, <em>ncen</em>, <em>lcname=None</em>, <em>metadata=None</em>, <em>metatags=None</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/proclens/xhandle/shearops.html#StackedProfileContainer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#proclens.xhandle.shearops.StackedProfileContainer" title="Permalink to this definition">¶</a></dt>
<dd><p>Object Oriented interface for stacked shear and <img class="math" src="_images/math/9397aece1d243efa28d3c70fa88edd48f9591b8a.png" alt="\Delta\Sigma"/> calculated via <strong>xshear</strong></p>
<p><strong>Features</strong></p>
<blockquote>
<div><ul class="simple">
<li>Jackknife based covariance estimation</li>
<li>Calculate <em>shear</em>, <em>DeltaSigma</em>, and other averaged quantities</li>
<li>Simple arithmetic with shear profiles: <code class="code docutils literal"><span class="pre">+,</span> <span class="pre">-,</span> <span class="pre">*,</span> <span class="pre">/</span></code></li>
<li>Integration with <em>Metacalibration</em> style selection responses</li>
</ul>
</div></blockquote>
<p><strong>Overview</strong></p>
<p>The lensing profile is calculated in two stages:</p>
<blockquote>
<div><ul class="simple">
<li>First, for each Jackknife-region defined by the <code class="code docutils literal"><span class="pre">labels</span></code>
(that is for all-except-one region) the lensing profile is calculated, and stored in
<code class="code docutils literal"><span class="pre">self.*_sub</span></code> (These are the JK-subprofiles).</li>
<li>Using these JK-subprofiles, the mean lensing profile and the corresponding covariance
is calculated via blockwise omitt-one Jackknife resampling.</li>
</ul>
</div></blockquote>
<p>In practice both of these steps are performed when calling <strong>self.prof_maker()</strong>, and the results are
stored in the below varaiables. The default quantity calculated is the <strong>DeltaSigma</strong>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">rr</span><span class="p">:</span>        <span class="n">radial</span> <span class="n">centers</span>
<span class="bp">self</span><span class="o">.</span><span class="n">dst</span><span class="p">:</span>       <span class="n">E</span><span class="o">-</span><span class="n">mode</span> <span class="n">lensing</span> <span class="n">signal</span>
<span class="bp">self</span><span class="o">.</span><span class="n">dst_err</span><span class="p">:</span>   <span class="n">error</span> <span class="k">for</span> <span class="n">E</span><span class="o">-</span><span class="n">mode</span> <span class="n">lensing</span> <span class="n">signal</span>
<span class="bp">self</span><span class="o">.</span><span class="n">dst_cov</span><span class="p">:</span>   <span class="n">covariance</span> <span class="k">for</span> <span class="n">E</span><span class="o">-</span><span class="n">mode</span> <span class="n">lensing</span> <span class="n">signal</span>
<span class="bp">self</span><span class="o">.</span><span class="n">dst</span><span class="p">:</span>       <span class="n">B</span><span class="o">-</span><span class="n">mode</span> <span class="n">lensing</span> <span class="n">signal</span>
<span class="bp">self</span><span class="o">.</span><span class="n">dst_err</span><span class="p">:</span>   <span class="n">error</span> <span class="k">for</span> <span class="n">B</span><span class="o">-</span><span class="n">mode</span> <span class="n">lensing</span> <span class="n">signal</span>
<span class="bp">self</span><span class="o">.</span><span class="n">dst_cov</span><span class="p">:</span>   <span class="n">covariance</span> <span class="k">for</span> <span class="n">B</span><span class="o">-</span><span class="n">mode</span>  <span class="n">lensing</span> <span class="n">signal</span>
</pre></div>
</div>
<p>A benefit of this two-step method, is that it allows for the quick calculation of errors on the
<strong>differences</strong>, <strong>ratios</strong> and other transformations of shear profiles.</p>
<p>In particular, the <strong>self.composite</strong> function allows four basic operations <code class="code docutils literal"><span class="pre">+,</span> <span class="pre">-,</span> <span class="pre">*,</span> <span class="pre">/</span></code>
between shear profiles, while the <strong>self.multiply</strong> function allows <code class="code docutils literal"><span class="pre">\*,</span> <span class="pre">/</span></code>
with integers or 1-D arrays (in which case each element is a value for a lens)</p>
<blockquote>
<div><p>E.g to calculate <img class="math" src="_images/math/5c97037ab92df40960474e23a12931fbed9b2ad0.png" alt="\Delta\Sigma_3 = \Delta\Sigma_2 - \Delta\Sigma_1"/>,
we only need to compute the differences of JK-subprofiles and
then re-compute the JK-mean, and JK-covariance.</p>
<p>In practice the above operation is achieved by:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># the operation is performed in-place, hence the deepcopy</span>
<span class="n">prof3</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">prof2</span><span class="p">)</span>
<span class="n">prof3</span><span class="o">.</span><span class="n">composite</span><span class="p">(</span><span class="n">prof1</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>Changing the physical quantity computed by <strong>self.prof_maker()</strong> is possibly by modifying the
columns used by the stacking algorithm. The default values used for <strong>DeltaSigma</strong> are:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># default values for stacked DeltaSigma</span>
<span class="bp">self</span><span class="o">.</span><span class="n">dst_nom</span> <span class="o">=</span> <span class="mi">4</span>
<span class="bp">self</span><span class="o">.</span><span class="n">dsx_nom</span> <span class="o">=</span> <span class="mi">5</span>
<span class="bp">self</span><span class="o">.</span><span class="n">dst_denom</span> <span class="o">=</span> <span class="mi">6</span>
<span class="bp">self</span><span class="o">.</span><span class="n">dsx_denom</span> <span class="o">=</span> <span class="mi">7</span>

<span class="bp">self</span><span class="o">.</span><span class="n">e1_nom</span> <span class="o">=</span> <span class="mi">10</span>
<span class="bp">self</span><span class="o">.</span><span class="n">e2_nom</span> <span class="o">=</span> <span class="mi">11</span>
<span class="bp">self</span><span class="o">.</span><span class="n">meta_denom</span> <span class="o">=</span> <span class="mi">3</span>
<span class="bp">self</span><span class="o">.</span><span class="n">meta_prefac</span> <span class="o">=</span> <span class="mi">2</span>
</pre></div>
</div>
<p>To calculate <strong>shear</strong> one would need to change the above to:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">dst_denom</span> <span class="o">=</span> <span class="mi">8</span>
<span class="bp">self</span><span class="o">.</span><span class="n">dsx_denom</span> <span class="o">=</span> <span class="mi">9</span>

<span class="bp">self</span><span class="o">.</span><span class="n">meta_denom</span> <span class="o">=</span> <span class="mi">3</span>
<span class="bp">self</span><span class="o">.</span><span class="n">meta_prefac</span> <span class="o">=</span> <span class="mi">3</span>
</pre></div>
</div>
<p>Further information on the column positions are found in the <strong>xread</strong> documentation…</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>info</strong> (<em>np.ndarray</em>) – <code class="code docutils literal"><span class="pre">info</span></code> table from <strong>xread</strong></li>
<li><strong>data</strong> (<em>np.ndarray</em>) – <code class="code docutils literal"><span class="pre">data</span></code> table from <strong>xread</strong></li>
<li><strong>labels</strong> (<em>np.array</em>) – JK-region labels</li>
<li><strong>ncen</strong> (<em>int</em>) – number of JK regions in total</li>
<li><strong>lcname</strong> (<em>str</em>) – tag string</li>
<li><strong>metadata</strong> (<em>list of np.ndarray</em>) – sheared versions of <code class="code docutils literal"><span class="pre">data</span></code></li>
<li><strong>metatags</strong> (<em>list of str</em>) – sheared tags</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="proclens.xhandle.shearops.StackedProfileContainer.prof_maker">
<code class="descname">prof_maker</code><span class="sig-paren">(</span><em>weights=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/proclens/xhandle/shearops.html#StackedProfileContainer.prof_maker"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#proclens.xhandle.shearops.StackedProfileContainer.prof_maker" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates the Jackknife estimate of on stacked profile and on the corresponding covariance</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>weights</strong> (<em>np.array</em>) – weight for each entry in the lens catalog</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="proclens.xhandle.shearops.StackedProfileContainer.composite">
<code class="descname">composite</code><span class="sig-paren">(</span><em>other</em>, <em>operation='-'</em>, <em>keep_rr=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/proclens/xhandle/shearops.html#StackedProfileContainer.composite"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#proclens.xhandle.shearops.StackedProfileContainer.composite" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate the JK estimate on the operation applied to the two profiles</p>
<p><strong>Possible Operations:</strong></p>
<blockquote>
<div><ul class="simple">
<li>“-“: self - other</li>
<li>“+”: self + other</li>
<li>“*”: self * other</li>
<li>“/”: self / other</li>
</ul>
</div></blockquote>
<p>The results is updated to self. Use deepcopy to obtain
copies of the object for storing the previous state.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>other</strong> (<em>StackedProfileContainer</em>) – an other profile…</li>
<li><strong>operation</strong> (<em>str</em>) – string specifying what to do…</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="proclens.xhandle.shearops.StackedProfileContainer.multiply">
<code class="descname">multiply</code><span class="sig-paren">(</span><em>val</em>, <em>keep_rr=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/proclens/xhandle/shearops.html#StackedProfileContainer.multiply"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#proclens.xhandle.shearops.StackedProfileContainer.multiply" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate the JK estimate on profile times the specified “val”,</p>
<p>Operation performed in-place.
Use deepcopy to obtain copies of the object for storing the previous state.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>val</strong> (<em>float or np.array</em>) – value to multiply by</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="proclens.xhandle.shearops.StackedProfileContainer.drop_data">
<code class="descname">drop_data</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/proclens/xhandle/shearops.html#StackedProfileContainer.drop_data"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#proclens.xhandle.shearops.StackedProfileContainer.drop_data" title="Permalink to this definition">¶</a></dt>
<dd><p>resets the <code class="code docutils literal"><span class="pre">info</span></code>, <code class="code docutils literal"><span class="pre">data</span></code> and <code class="code docutils literal"><span class="pre">labels</span></code> containers to <code class="code docutils literal"><span class="pre">None</span></code></p>
<p>This reduces the size of the object in memory, but cannot re-stack the lenses anymore.
Leaves the profile, JK-subprofiles and ancillary quantities unaffected</p>
</dd></dl>

<dl class="method">
<dt id="proclens.xhandle.shearops.StackedProfileContainer.to_sub_dict">
<code class="descname">to_sub_dict</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/proclens/xhandle/shearops.html#StackedProfileContainer.to_sub_dict"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#proclens.xhandle.shearops.StackedProfileContainer.to_sub_dict" title="Permalink to this definition">¶</a></dt>
<dd><p>Extracts the calculated profile and ancillary information to a dictionary</p>
<p>The resulting dict does not contain the base data, only the profile, the JK-subprofiles and
ancillary quantities</p>
</dd></dl>

<dl class="classmethod">
<dt id="proclens.xhandle.shearops.StackedProfileContainer.from_sub_dict">
<em class="property">classmethod </em><code class="descname">from_sub_dict</code><span class="sig-paren">(</span><em>sub_dict</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/proclens/xhandle/shearops.html#StackedProfileContainer.from_sub_dict"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#proclens.xhandle.shearops.StackedProfileContainer.from_sub_dict" title="Permalink to this definition">¶</a></dt>
<dd><p>Reconstructs the object from a dictionary</p>
<p>The resulting object does not contain the base data, only the profile, JK-subprofiles and
ancillary quantities</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="jackknife-covariance-estimate-from-multiple-lensing-profiles">
<h2>Jackknife Covariance estimate from multiple lensing profiles<a class="headerlink" href="#jackknife-covariance-estimate-from-multiple-lensing-profiles" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="proclens.xhandle.shearops.stacked_pcov">
<code class="descclassname">proclens.xhandle.shearops.</code><code class="descname">stacked_pcov</code><span class="sig-paren">(</span><em>plist</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/proclens/xhandle/shearops.html#stacked_pcov"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#proclens.xhandle.shearops.stacked_pcov" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates the Covariance between a list of profiles</p>
<p>Only elements where both profile has at least 1 sources are considered, the rest is filled with placeholder
values (-9999.0 by default).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>plist</strong> (<em>list of StackedProfileContainer objects</em>) – profiles across whiche the covarainces are to be calcualted</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">cov (E-mode), cov (B-mode)</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">np.array, np.array</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
</div>
<div class="section" id="ancillary-utilities">
<h1>Ancillary utilities<a class="headerlink" href="#ancillary-utilities" title="Permalink to this headline">¶</a></h1>
<div class="section" id="observed-to-absolute-magnitude-conversion">
<h2>Observed to absolute magnitude conversion<a class="headerlink" href="#observed-to-absolute-magnitude-conversion" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="proclens.tools.magtools.AbsMagConverter">
<em class="property">class </em><code class="descclassname">proclens.tools.magtools.</code><code class="descname">AbsMagConverter</code><span class="sig-paren">(</span><em>cosmo='default'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/proclens/tools/magtools.html#AbsMagConverter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#proclens.tools.magtools.AbsMagConverter" title="Permalink to this definition">¶</a></dt>
<dd><p>Apparent to Absolute magnitude conversion for red galaxies</p>
<p>Uses distance modulus + k-correction with single template</p>
<p class="rubric">Examples</p>
<p>without saving lookup table:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># response function of the survey</span>
<span class="n">resp</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;survey&quot;</span><span class="p">:</span> <span class="s2">&quot;DES&quot;</span><span class="p">,</span>  <span class="c1"># name string for survey</span>
    <span class="s2">&quot;lambda&quot;</span><span class="p">:</span> <span class="n">lambda_array</span><span class="p">,</span>  <span class="c1"># array of wavelength values</span>
    <span class="s2">&quot;lambda unit&quot;</span><span class="p">:</span> <span class="s2">&quot;nm&quot;</span>  <span class="c1">#  this must be the same for the response and</span>
                         <span class="c1">#  the template</span>
    <span class="s2">&quot;bands&quot;</span><span class="p">:</span> <span class="n">bands</span> <span class="c1">#  dictionary of band name, response array pairs</span>
                   <span class="c1">#  bands = {&quot;r&quot;: r_arr, &quot;g&quot;: g_arr}</span>
<span class="p">}</span>

<span class="c1"># template spectra for the conversion</span>
<span class="n">templ</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;red quiescent&quot;</span><span class="p">,</span>
    <span class="s2">&quot;lambda&quot;</span><span class="p">:</span> <span class="n">lambda_array</span><span class="p">,</span>  <span class="c1"># array of wavelength values</span>
    <span class="s2">&quot;lambda unit&quot;</span><span class="p">:</span> <span class="s2">&quot;nm&quot;</span><span class="p">,</span>  <span class="c1">#  this must be the same for the response and</span>
                          <span class="c1">#  the template</span>
    <span class="s2">&quot;sed&quot;</span><span class="p">:</span> <span class="n">sed</span><span class="p">,</span>  <span class="c1"># Values corresponding to the lambda values</span>
    <span class="s2">&quot;sed unit&quot;</span><span class="p">:</span> <span class="s2">&quot;Normalized Flux&quot;</span> <span class="c1"># this is OK as long as the norm flag</span>
                                  <span class="c1"># is on when specifying the template</span>
<span class="p">}</span>

<span class="n">aconv</span> <span class="o">=</span> <span class="n">AbsMagConverter</span><span class="p">(</span><span class="n">cosmo</span><span class="o">=</span><span class="n">astropy</span><span class="o">.</span><span class="n">cosmology</span><span class="o">.</span><span class="n">FlatLambdaCDM</span><span class="p">(</span><span class="n">H0</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span> <span class="n">Om0</span><span class="o">=</span><span class="mf">0.3</span><span class="p">))</span>
<span class="n">aconv</span><span class="o">.</span><span class="n">add_response</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
<span class="n">aconv</span><span class="o">.</span><span class="n">add_template</span><span class="p">(</span><span class="n">templ</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># here mag is the set of apparent magnitudes, and z is the redshift</span>
<span class="c1"># of each object. band is the string name of the band, like &quot;r&quot;</span>
<span class="n">absmag</span> <span class="o">=</span> <span class="n">aconv</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mag</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">band</span><span class="p">,</span> <span class="n">z2</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                       <span class="n">z_0</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">z_1</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">use_tables</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># after the conversion is complete we can save the used lookup table</span>
<span class="c1"># for later use with a pickle!</span>

<span class="n">aconv</span><span class="o">.</span><span class="n">save_tables</span><span class="p">(</span><span class="s2">&quot;mytable.p&quot;</span><span class="p">)</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>cosmo</strong> (<em>astropy.cosmology.FlatLambdaCDM</em>) – cosmology to use, default: H0=70, Om0=0.3</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="fits-to-pandas-conversion">
<h2>FITS to pandas conversion<a class="headerlink" href="#fits-to-pandas-conversion" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="proclens.tools.catalogs.to_pandas">
<code class="descclassname">proclens.tools.catalogs.</code><code class="descname">to_pandas</code><span class="sig-paren">(</span><em>recarr</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/proclens/tools/catalogs.html#to_pandas"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#proclens.tools.catalogs.to_pandas" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts potentially nested record array (such as a FITS Table) into Pandas DataFrame</p>
<p>FITS tables sometimes have multidimensional columns, which are not supported for DataFrames
Pandas DataFrames however provide many nice features, such as SQL speed database matchings.</p>
<p>The approach is to flatten out multidimensional column [[COL]] into [COL_1, COL_2, …, COL_N]</p>
<p class="rubric">Examples</p>
<p>Just pass the loaded FITS table:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">fitsio</span> <span class="k">as</span> <span class="nn">fio</span>
<span class="kn">import</span> <span class="nn">proclens.io.catalogs</span> <span class="k">as</span> <span class="nn">catalogs</span>

<span class="n">raw_data</span> <span class="o">=</span> <span class="n">fio</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">&quot;data.fits&quot;</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">catalogs</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">(</span><span class="n">raw_data</span><span class="p">)</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>recarr</strong> (<em>numpy.array</em>) – array to be converted to DataFrame</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">array as DataFrame</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">pandas.DataFrame</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="parameter-selection">
<h2>parameter selection<a class="headerlink" href="#parameter-selection" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="proclens.tools.selector.selector">
<code class="descclassname">proclens.tools.selector.</code><code class="descname">selector</code><span class="sig-paren">(</span><em>pps</em>, <em>limits</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/proclens/tools/selector.html#selector"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#proclens.tools.selector.selector" title="Permalink to this definition">¶</a></dt>
<dd><p>Applies selection to array based on the passed parameter limits</p>
<p>Selection is defined like <img class="math" src="_images/math/d9bb85c8c1f5039a029ee099c6a46fda55d4b180.png" alt="x\in[x_0;\;x_1)"/></p>
<p class="rubric">Examples</p>
<p>First make some mock data:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">nrows</span> <span class="o">=</span> <span class="mi">100000</span>
<span class="n">ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="n">ra</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">360.</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">nrows</span><span class="p">)</span>
<span class="n">dec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=-</span><span class="mf">60.</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">nrows</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">nrows</span><span class="p">)</span>
<span class="n">lamb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">nrows</span><span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">lamb</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
<p>then define binning edges:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ra_edges</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">100.</span><span class="p">,</span> <span class="mf">300.</span><span class="p">)</span>
<span class="n">dec_edges</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">60.</span><span class="p">,</span> <span class="o">-</span><span class="mf">30.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">)</span>
<span class="n">z_edges</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span>
<span class="n">lamb_edges</span> <span class="o">=</span> <span class="p">(</span><span class="mf">20.</span><span class="p">,</span> <span class="mf">30.</span><span class="p">,</span> <span class="mf">45.</span><span class="p">,</span> <span class="mf">60.</span><span class="p">)</span>

<span class="n">edges</span> <span class="o">=</span> <span class="p">(</span><span class="n">ra_edges</span><span class="p">,</span> <span class="n">dec_edges</span><span class="p">,</span> <span class="n">z_edges</span><span class="p">,</span> <span class="n">lamb_edges</span><span class="p">)</span>
</pre></div>
</div>
<p>This selection divides the data into 24 bins in 4-D space, which we
can obtain perform as:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sinds</span><span class="p">,</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">plpairs</span> <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">selector</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">edges</span><span class="p">)</span>
</pre></div>
</div>
<p>Let’s inspect the output, <code class="code docutils literal"><span class="pre">sinds</span></code> contains the boolean indexing arrays to
select rows by, while <code class="code docutils literal"><span class="pre">bounds</span></code> shows the corresponding parameter boundaries,
for example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bounds</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span>
<span class="go">((0, (100.0, 300.0)), (1, (-60.0, -30.0)), (2, (0.2, 0.4)), (3, (30.0, 45.0)))</span>
</pre></div>
</div>
<p>where the first number indicates the column of the data file it corresponds to, and the
tuple contains the parameter boundaries for that column. Indeed we find:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="p">[</span><span class="n">sinds</span><span class="p">[</span><span class="mi">13</span><span class="p">],</span> <span class="p">:]</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="go">array([ 100.03881951,  -59.96803764,    0.20010631,   30.02361767])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="p">[</span><span class="n">sinds</span><span class="p">[</span><span class="mi">13</span><span class="p">],</span> <span class="p">:]</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="go">array([ 299.68649402,  -30.00117535,    0.39994843,   44.99060231])</span>
</pre></div>
</div>
<p>which are the boundaries we were expecting</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>pps</strong> (<em>np.array N-D</em>) – numpy array with N rows, containing the parameters to split the sample by</li>
<li><strong>limits</strong> (<em>list of lists</em>) – list of parameter limits, each element contains limits for a columna of pps</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">list of boolean indices (one for each selection),
list of param limits corresponding to each selection
parameter limits expanded from sequence to list of tuples</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">list, list, list</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="list-partitioning">
<h2>list partitioning<a class="headerlink" href="#list-partitioning" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="proclens.tools.selector.partition">
<code class="descclassname">proclens.tools.selector.</code><code class="descname">partition</code><span class="sig-paren">(</span><em>lst</em>, <em>n</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/proclens/tools/selector.html#partition"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#proclens.tools.selector.partition" title="Permalink to this definition">¶</a></dt>
<dd><p>Divides a list into N roughly equal chunks</p>
<p class="rubric">Examples</p>
<p>Define some test list, and look at the obtained chunks with different <code class="code docutils literal"><span class="pre">n</span></code> values:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">lst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lst</span>
<span class="go">array([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16,</span>
<span class="go">17, 18, 19])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">partition</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="go">[array([0, 1, 2, 3]),</span>
<span class="go"> array([4, 5, 6, 7]),</span>
<span class="go"> array([ 8,  9, 10, 11]),</span>
<span class="go"> array([12, 13, 14, 15]),</span>
<span class="go"> array([16, 17, 18, 19])]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">partition</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="go">[array([0, 1, 2]),</span>
<span class="go"> array([3, 4, 5, 6]),</span>
<span class="go"> array([7, 8, 9]),</span>
<span class="go"> array([10, 11, 12]),</span>
<span class="go"> array([13, 14, 15, 16]),</span>
<span class="go"> array([17, 18, 19])]</span>
</pre></div>
</div>
<p>As we can see, even when <code class="code docutils literal"><span class="pre">n</span></code> is not a divisor of <code class="code docutils literal"><span class="pre">len(lst)</span></code>, it returns
roughly balanced chunks</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>lst</strong> (<em>list</em>) – list to split up</li>
<li><strong>n</strong> (<em>int</em>) – chunks to make</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">list of chunks</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">list of lists</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="safe-divide">
<h2>safe divide<a class="headerlink" href="#safe-divide" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="proclens.tools.selector.safedivide">
<code class="descclassname">proclens.tools.selector.</code><code class="descname">safedivide</code><span class="sig-paren">(</span><em>x</em>, <em>y</em>, <em>eps=1e-08</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/proclens/tools/selector.html#safedivide"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#proclens.tools.selector.safedivide" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates x / y for arrays, setting result to zero if x ~ 0 OR y ~ 0</p>
<p>Defined such that</p>
<blockquote>
<div><img class="math" src="_images/math/f89f07b3646e952c5b49a8d789f61c1c2491ebb0.png" alt="5 / 5 \rightarrow 1"/></div></blockquote>
<p>but</p>
<blockquote>
<div><img class="math" src="_images/math/40433a485236c5129b82df3fb25b0ef617f83649.png" alt="5 / 0 \rightarrow 0"/> and <img class="math" src="_images/math/afc93ef992ba88a5e4f07243e9cd3e7629053fae.png" alt="0 / 5 \rightarrow 0"/> and <img class="math" src="_images/math/cd02b624cb949df13c17962b983c73b451e8d521.png" alt="0 / 0 \rightarrow 0"/></div></blockquote>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>x</strong> (<em>np.array</em>)</li>
<li><strong>y</strong> (<em>np.array</em>)</li>
<li><strong>eps</strong> (<em>float</em>) – threshold for setting element to zero</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">x / y where (xabs &gt; eps) and (yabs &gt; eps), 0 elsewhere</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">np.array</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
</div>
<div class="section" id="visualization">
<h1>Visualization<a class="headerlink" href="#visualization" title="Permalink to this headline">¶</a></h1>
<div class="section" id="corner-plot">
<h2>corner plot<a class="headerlink" href="#corner-plot" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="proclens.tools.visual.corner">
<code class="descclassname">proclens.tools.visual.</code><code class="descname">corner</code><span class="sig-paren">(</span><em>par_names</em>, <em>pars</em>, <em>par_edges</em>, <em>figsize=(8</em>, <em>8)</em>, <em>color='black'</em>, <em>fig=None</em>, <em>axarr=None</em>, <em>mode='hist'</em>, <em>cmap='gray_r'</em>, <em>normed=True</em>, <em>fontsize=12</em>, <em>tick_list=None</em>, <em>clevels=(0.68</em>, <em>0.95)</em>, <em>grid=True</em>, <em>weights=None</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/proclens/tools/visual.html#corner"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#proclens.tools.visual.corner" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates <em>NICE</em> corner plot (check if pars have the righ orientation, perhaps use pars.T)</p>
<p class="rubric">Example</p>
<p>Simple 2D gaussian with marginals and joint distribution:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">proclens</span> <span class="k">as</span> <span class="nn">proclens</span>

<span class="c1"># generate mock data</span>
<span class="n">means</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">cov</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]]</span>
<span class="n">pars</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="n">means</span><span class="p">,</span> <span class="n">cov</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mf">1e4</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>

<span class="c1"># define names and edges</span>
<span class="n">par_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;$x$&quot;</span><span class="p">,</span> <span class="s2">&quot;$y$&quot;</span><span class="p">]</span>
<span class="n">par_edges</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axarr</span> <span class="o">=</span> <span class="n">proclens</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">visual</span><span class="o">.</span><span class="n">corner</span><span class="p">(</span><span class="n">par_names</span><span class="p">,</span> <span class="n">pars</span><span class="p">,</span> <span class="n">par_edges</span><span class="p">)</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>par_names</strong> (<em>list of strings</em>) – names of parameters as they should appear on figure</li>
<li><strong>pars</strong> (<em>np.ndarray</em>) – the DATA to show, (might have to transpose it!</li>
<li><strong>par_edges</strong> (<em>list of tuples</em>) – parameter limits</li>
<li><strong>figsize</strong> (<em>tuple</em>) – size of matplotlib figure</li>
<li><strong>color</strong> (<em>str</em>) – primary color to use</li>
<li><strong>fig</strong> (<em>mpl.figure</em>) – figure</li>
<li><strong>axarr</strong> (<em>list of mpl.axes</em>) – axarr</li>
<li><strong>mode</strong> (<em>str</em>) – hist or contour</li>
<li><strong>cmap</strong> (<em>str</em>) – matplotlib color map to use for histogram</li>
<li><strong>normed</strong> (<em>bool</em>) – normalize histograms across subplots</li>
<li><strong>fontsize</strong> (<em>int</em>) – fontsize</li>
<li><strong>tick_list</strong> (<em>list of np.arrays</em>) – list of tick positions for each axis</li>
<li><strong>clevels</strong> (<em>list</em>) – contour levels as contained probability</li>
<li><strong>weights</strong> (<em>weights for each entry in pars</em>)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">fig, axarr</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">plt.figure, (plt.axis, .., plt.axis)</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="faq.html" class="btn btn-neutral" title="Frequently Asked Questions" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Tamas Norbert Varga.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>